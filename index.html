<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Clicker Chupa Chups</title>
    <style>
        body {
            margin: 0;
            background: #ffefd5;
            overflow: hidden;
            font-family: sans-serif;
        }
        #score {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 20px;
            background: rgba(255,255,255,0.8);
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 10;
        }
        #restartBtn {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            padding: 10px 20px;
            background: #ff5252;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            z-index: 20;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>

<div id="score">Score : 0</div>
<button id="restartBtn">Rejouer</button>
<canvas id="game"></canvas>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const restartBtn = document.getElementById("restartBtn");

  let score = 0;
  let gameOver = false;
  let lollipops = [];

  const zoneWidth = canvas.width * 0.6;
  const zoneHeight = canvas.height;
  const zoneX = (canvas.width - zoneWidth) / 2;
  const zoneY = 0;

  const lollipopImages = [];
  for (let i = 1; i <= 5; i++) {
    const img = new Image();
    img.src = `chupa${i}.png`;
    lollipopImages.push(img);
  }

  class Lollipop {
    constructor() {
      this.size = 100;
      this.x = zoneX + Math.random() * (zoneWidth - this.size);
      this.y = -this.size;
      this.speed = 2 + Math.random() * 2 + score / 10;
      this.image = lollipopImages[Math.floor(Math.random() * lollipopImages.length)];
      this.angle = Math.random() * Math.PI * 2;
    }
    draw() {
      if (this.image.complete && this.image.naturalWidth > 0) {
        ctx.save();
        ctx.translate(this.x + this.size / 2, this.y + this.size / 2);
        ctx.rotate(this.angle);
        ctx.drawImage(this.image, -this.size / 2, -this.size / 2, this.size, this.size);
        ctx.restore();
      }
    }
    update() {
      this.y += this.speed;
      if (this.y > canvas.height) {
        gameOver = true;
        restartBtn.style.display = "block";
      }
    }
  }

  function drawZone() {
    ctx.fillStyle = "rgba(0,0,0,0.05)";
    ctx.fillRect(zoneX, zoneY, zoneWidth, zoneHeight);
    ctx.fillStyle = "#444";
    ctx.font = "40px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("iphi ðŸ‘‘", canvas.width / 2, canvas.height / 2);
  }

  function spawnLollipop() {
    if (!gameOver) {
      lollipops.push(new Lollipop());
      setTimeout(spawnLollipop, 1000 + Math.random() * 1000);
    }
  }

  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawZone();

    for (let i = lollipops.length - 1; i >= 0; i--) {
      lollipops[i].update();
      lollipops[i].draw();
    }

    if (gameOver) {
      ctx.fillStyle = "rgba(0,0,0,0.7)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#fff";
      ctx.font = "50px sans-serif";
      ctx.fillText("Perdu ! Score : " + score, canvas.width / 2, canvas.height / 2);
      return;
    }

    requestAnimationFrame(gameLoop);
  }

  canvas.addEventListener("click", (e) => {
    for (let i = lollipops.length - 1; i >= 0; i--) {
      let lp = lollipops[i];
      if (
        e.clientX >= lp.x &&
        e.clientX <= lp.x + lp.size &&
        e.clientY >= lp.y &&
        e.clientY <= lp.y + lp.size
      ) {
        lollipops.splice(i, 1);
        score++;
        document.getElementById("score").textContent = "Score : " + score;
        break;
      }
    }
  });

  restartBtn.addEventListener("click", () => {
    score = 0;
    gameOver = false;
    lollipops = [];
    document.getElementById("score").textContent = "Score : 0";
    restartBtn.style.display = "none";
    spawnLollipop();
    gameLoop();
  });

  spawnLollipop();
  gameLoop();
</script>

</body>
</html>
